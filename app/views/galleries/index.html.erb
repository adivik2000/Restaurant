<h1>Galleries</h1>
<div id="gallery_menu">
	<ul>
		<li class="selected">All</li>
		<% @galleries.each do |gallery| %>
		<li><%= link_to gallery.name, :controller => 'galleries', :action => 'show', :id => gallery.id %></li>
		<% end %>
	</ul>

</div>
<div id="gallery_content">
	<div id="gallery_caption">
		<%= @first_photo.caption %><br />
	</div>
	<div id="gallery_main_image">
		<%= image_tag @first_photo.photo.url, :class => 'test', :width => '500px'%><br />
		<a class="previous" id="previous_main"><%= image_tag 'plane_food/arrow_left.png' %></a>
		<a class="next" id="next_main"><%= image_tag 'plane_food/arrow_right.png' %></a><br />
	</div>
	<div id="thumbnails">
		<div class="block">
			<ul>
				<% @photos.each do |photo| %>
				<li class="thumb">
					<%= image_tag photo.photo.url(:thumb), :class => 'thumb', :width => '113px', :full_url => photo.photo.url, :caption => photo.caption %>
				</li>
				<% end %>
			</ul>
		</div>
	</div>

</div>	

<script>

$('li.thumb:eq(0)').addClass('selected');

$("li.thumb").click(function () {

	var imgsrc = ($("img", this).attr("full_url"));
	var imgcaption = ($("img", this).attr("caption"));	
	$("img.test").attr("src", imgsrc);
	$("#gallery_caption").text("");	
	$("#gallery_caption").text(imgcaption);

	var thisimage = $(this);
	var thisindex = $('li.thumb').index(thisimage);
	var imgselected = $('.block li.selected');
	var selectedindex = $('li.thumb').index(imgselected);
	var last_image = $("li.thumb").length;
	

	if ( thisindex == selectedindex + 1 && thisindex > 1 && thisindex < last_image - 2){
		$(".block").animate({"left": "-=127px"}, "slow");
	}


	else if ( (thisindex == selectedindex + 2 || thisindex == selectedindex + 3) && thisindex !== 2 && thisindex < last_image - 2){
		$(".block").animate({"left": "-=254px"}, "slow");
	}

	
	else if ( thisindex == selectedindex + 2  && thisindex == last_image - 2 && last_image > 4){
		$(".block").animate({"left": "-=127px"}, "slow");
	}
	
	else if ( thisindex == selectedindex + 2 && thisindex == 2 && last_image > 4 ){
		$(".block").animate({"left": "-=127px"}, "slow");
	}

	else if ( thisindex < selectedindex && thisindex > 0 && thisindex < last_image - 3 ){
		$(".block").animate({"left": "+=127px"}, "slow");
	}
	
	$("li.selected").removeClass("selected");
	$(this).addClass("selected");	

});

$("a.next").click(function () {
	var imgselected = $('.block li.selected');
	var selectedindex = $('li.thumb').index(imgselected);
	var last_image = $("li.thumb").length;
	var next = selectedindex + 1;
	var nextimage = $('li.thumb:eq('+next+') img').attr("full_url");
	var nextcaption = $('li.thumb:eq('+next+') img').attr("caption");

	if (selectedindex < last_image - 1) {
						
		$("img.test").attr("src", nextimage);
		$("#gallery_caption").text("");
		$("#gallery_caption").text(nextcaption);	
		$(".block li.selected").removeClass("selected");
		$("li.thumb:eq(" +next+ ")").addClass("selected");
	}	

		
		if ( selectedindex > 0 && selectedindex < last_image - 3 ) {
			$(".block").animate({"left": "-=127px"}, "slow");
		}



});

$("a.previous").click(function () {
	var imgselected = $('.block li.selected');
	var selectedindex = $('li.thumb').index(imgselected);
	var number_of_images = $("li.thumb").length;
	var last_image = $("li.thumb").length;	
	var previous = selectedindex - 1;
	var previous_image = $('li.thumb:eq('+previous+') img').attr("full_url");
	var previous_caption = $('li.thumb:eq('+previous+') img').attr("caption");	

	if (selectedindex > 0) {
		$("img.test").attr("src", previous_image);
		$("#gallery_caption").text("");
		$("#gallery_caption").text(previous_caption);	
		$(".block li.selected").removeClass("selected");
		$("li.thumb:eq(" +previous+ ")").addClass("selected");	
	}	

		
		if ( selectedindex > 1 && selectedindex < last_image - 2) {
			$(".block").animate({"left": "+=127px"}, "slow");
		}

});

</script>
